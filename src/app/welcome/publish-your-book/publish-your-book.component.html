<div *transloco="let t" class="publish-your-book d-flex justify-content-center w-100 h-100">

    <div class="m-4">

        <div class="mb-2 d-flex align-items-center gap-2">
            <button (click)="goBack()" ly-button appearance="icon">
                <svg style="width:26px;height:26px" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
                </svg>
            </button>
            <h2>{{t('pub_ur_book')}}</h2>
        </div>

        <div class="progress shadow">
            <div class="progress-bar" role="progressbar" [style.width]="uploadProgress+'%'"
                style="padding-bottom: .5rem;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"> <span>
                    {{uploadProgress}}% </span> </div>
        </div>

        <form [formGroup]="bookPublishForm" class="form  publish-book-container">

            <ly-accordion>
                <ly-expansion-panel [expanded]="true">
                    <ly-expansion-panel-header>
                        <ly-panel-title>
                            <h4>
                                {{t('step_1')}}
                            </h4>

                        </ly-panel-title>
                        <ly-panel-description>
                            <h4>{{t('ur_book_details')}}</h4>
                        </ly-panel-description>
                    </ly-expansion-panel-header>

                    <p class="text-muted my-1">{{t('req_fields')}}</p>

                    <form *transloco="let t" [formGroup]="bookDetailsForm">

                        <div class="d-flex gap-1 mb-2">
                            <label class="form-label label-lg flex-shrink-0" for="bookNameFC">{{ t('book_name') }} <span
                                    class="text-muted">*</span></label>

                            <div class="form-group"
                                [ngClass]="{'has-error':bookNameFC.hasError('required') && bookNameFC.touched}">

                                <input type="text" class="form-input input-lg account-name" id="bookNameFC"
                                    formControlName="bookNameFC">

                                <p *ngIf="bookNameFC.hasError('required') && bookNameFC.touched"
                                    class="form-input-hint">
                                    {{ t('book_name_req') }}
                                </p>

                            </div>
                        </div>

                        <div class="d-flex mb-2 gap-1">
                            <label class="form-label label-lg flex-shrink-0">{{ t('category') }} <span
                                    class="text-muted">*</span> </label>

                            <div class="form-group category"
                                [ngClass]="{'has-error':bookCatgoryFC.hasError('required') && bookCatgoryFC.touched}">
                                <select formControlName="bookCatgoryFC" class="form-select select-lg category">
                                    <option *ngFor="let bookCategory of bookCategories" value="{{bookCategory}}">{{bookCategory}}</option>
                                </select>

                                <p *ngIf="bookCatgoryFC.hasError('required') && bookCatgoryFC.touched"
                                    class="form-input-hint">
                                    {{ t('book_cat_req') }}
                                </p>
                            </div>
                        </div>

                        <div class="d-flex gap-1 mb-2">
                            <label class="form-label label-lg flex-shrink-0" for="bookAuthorFC">{{ t('author') }} <span
                                    class="text-muted">*</span> </label>

                            <div class="form-group"
                                [ngClass]="{'has-error':(bookAuthorFC.hasError('required')|| bookAuthorFC.hasError('minlength')) && bookAuthorFC.touched}">

                                <input type="text" class="form-input input-lg account-name" id="bookAuthorFC"
                                    formControlName="bookAuthorFC">

                                <p *ngIf="(bookAuthorFC.hasError('required') || bookAuthorFC.hasError('minlength')) && bookAuthorFC.touched"
                                    class="form-input-hint">
                                    {{ t('author_name_req') }}
                                </p>

                            </div>
                        </div>

                        <div class="d-flex gap-1 mb-2">
                            <label class="form-label label-lg flex-shrink-0" for="bookISBNFC">{{ t('isbn') }}</label>

                            <div class="form-group"
                                [ngClass]="{'has-error':bookISBNFC.hasError('pattern') && bookISBNFC.dirty}">
                                <input type="number" class="form-input input-lg account-name" id="bookISBNFC"
                                    formControlName="bookISBNFC">
                                <p *ngIf="(bookISBNFC.hasError('pattern')) && bookISBNFC.dirty" class="form-input-hint">
                                    {{ t('enter_valid_isbn') }}
                                </p>

                            </div>
                        </div>

                        <div class="d-flex gap-1 mb-2">

                            <label class="form-label label-lg flex-shrink-0" for="bookPriceFC">{{ t('price') }} <span
                                    class="text-muted">*</span> </label>

                            <div class="form-group price"
                                [ngClass]="{'has-error':bookPriceFC.hasError('required')  && bookPriceFC.touched}">
                                <div class="input-group price">
                                    <span class="input-group-addon">{{sellerCurrency}}</span>
                                    <input class="form-input input-lg" type="number" formControlName="bookPriceFC">
                                </div>

                                <p *ngIf="bookPriceFC.hasError('required') &&  bookPriceFC.touched"
                                    class="form-input-hint">
                                    {{ t('price_req') }}
                                </p>
                            </div>
                        </div>

                        <div class="d-flex gap-1 mb-2">

                            <label class="form-label label-lg flex-shrink-0" for="bookDescFC">{{ t('desc') }} <span
                                    class="text-muted">*</span>
                            </label>

                            <div class="form-group"
                                [ngClass]="{'has-error':bookDescFC.hasError('required') && bookDescFC.touched}">
                                <textarea maxlength="4000" class="form-input" formControlName="bookDescFC"
                                    id="bookDescFC"></textarea>

                                <p *ngIf="bookDescFC.hasError('required') && bookDescFC.touched"
                                    class="form-input-hint">
                                    {{ t('book_desc_req') }}
                                </p>
                            </div>

                        </div>

                    </form>

                    <ly-action-row>
                        <button (click)="_bookAssetsPanel.open()" class="mr-1 next-btn" disabled
                            [disabled]="!bookDetailsForm.valid" ly-button bg="primary">{{t('next')}}</button>
                    </ly-action-row>
                </ly-expansion-panel>

                <ly-expansion-panel [disabled]="!bookDetailsForm.valid" #_bookAssetsPanel>
                    <ly-expansion-panel-header>
                        <ly-panel-title>
                            <h4>
                                {{t('step_2')}}
                            </h4>
                        </ly-panel-title>
                        <ly-panel-description>
                            <h4>{{t('ur_book_assets')}}</h4>
                        </ly-panel-description>
                    </ly-expansion-panel-header>

                    <div class="d-flex gap-1 mb-2 mt-1">
                        <label class="form-label label-lg flex-shrink-0" for="bookDocumentFC">{{ t('book_pdf') }}
                            <span class="text-muted">*</span></label>

                        <div class="form-group"
                            [ngClass]="{'has-error':(bookDocumentFC.hasError('required')  && bookDocumentFC.touched) || inValidBook}">

                            <input type="file" max="1" accept="application/pdf" (change)="onBookFileUpload($event)"
                                class="form-input input-lg" id="bookDocumentFC" formControlName="bookDocumentFC">

                            <p *ngIf="bookDocumentFC.hasError('required') && bookDocumentFC.touched"
                                class="form-input-hint">
                                {{ t('book_file_req') }}
                            </p>

                            <p *ngIf="inValidBook" class="form-input-hint">
                                {{ inValidBookMsg }}
                            </p>

                        </div>
                    </div>

                    <div>
                        <div class="d-flex gap-1">

                            <label class="form-label label-lg flex-shrink-0 book-cover-label"
                                for="bookCoverFC">{{ t('book_cover') }} (PNG only) <span class="text-muted">*</span>
                                <br>
                                <span class="text-muted">(h-500px X w-400px)</span>
                            </label>

                            <div class="form-group"
                                [ngClass]="{'has-error':(bookCoverFC.hasError('required') && bookCoverFC.touched)|| inValidBookCover}">
                                <input #_fileInput type="file" max="1" class="form-input input-lg" id="bookCoverFC"
                                    formControlName="bookCoverFC" (change)="openCropperDialog($event)"
                                    accept="image/png" hidden>

                                <button ly-button (click)="chooseACoverImage(_fileInput)">
                                    <i>
                                        <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                            <path fill="currentColor"
                                                d="M5,3A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H14.09C14.03,20.67 14,20.34 14,20C14,19.32 14.12,18.64 14.35,18H5L8.5,13.5L11,16.5L14.5,12L16.73,14.97C17.7,14.34 18.84,14 20,14C20.34,14 20.67,14.03 21,14.09V5C21,3.89 20.1,3 19,3H5M19,16V19H16V21H19V24H21V21H24V19H21V16H19Z" />
                                        </svg>
                                    </i>
                                    <span [lyPe]="1">{{ t('choose_cover') }}</span>
                                </button>

                                <p *ngIf="bookCoverFC.hasError('required') && bookCoverFC.touched"
                                    class="form-input-hint">
                                    {{ t('book_cover_req') }}
                                </p>

                                <p *ngIf="inValidBookCover" class="form-input-hint">
                                    {{ inValidCoverMsg }}
                                </p>

                            </div>
                        </div>
                        <div *ngIf="croppedImage" class="border text-center shadow-sm mt-2 cover-frame">
                            <img [src]="croppedImage">
                        </div>
                    </div>

                    <button (click)="submitFormData()"
                        [disabled]="!bookPublishForm.valid || inValidBookCover || inValidBook" type="submit"
                        class="mt-2" ly-button bg="primary">
                        <i>
                            <svg style="width:24px;height:24px" viewBox="0 0 24 24">
                                <path fill="currentColor"
                                    d="M2 12H4V17H20V12H22V17C22 18.11 21.11 19 20 19H4C2.9 19 2 18.11 2 17V12M12 2L6.46 7.46L7.88 8.88L11 5.75V15H13V5.75L16.13 8.88L17.55 7.45L12 2Z" />
                            </svg>
                        </i>

                        <span [lyPe]="1">
                            {{ t('publish') }}
                        </span>

                    </button>

                </ly-expansion-panel>
            </ly-accordion>

        </form>
    </div>

</div>
